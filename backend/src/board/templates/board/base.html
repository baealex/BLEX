<!DOCTYPE html>
{% load resource %}
{% load island %}
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="origin" />
    <title>{% block title %}BLEX{% endblock %}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="{% island_css 'styles/main.scss' %}">
    <link rel="icon" href="{% resource 'favicon.ico' %}" />
    <link rel="apple-touch-icon" sizes="57x57" href="{% resource 'logo57.png' %}" />
    <link rel="apple-touch-icon" sizes="72x72" href="{% resource 'logo72.png' %}" />
    <link rel="apple-touch-icon" sizes="76x76" href="{% resource 'logo76.png' %}" />
    <link rel="apple-touch-icon" sizes="114x114" href="{% resource 'logo114.png' %}" />
    <link rel="apple-touch-icon" sizes="120x120" href="{% resource 'logo120.png' %}" />
    <link rel="apple-touch-icon" sizes="144x144" href="{% resource 'logo144.png' %}" />
    <link rel="apple-touch-icon" sizes="152x152" href="{% resource 'logo152.png' %}" />
    <link rel="icon" type="image/png" sizes="16x16" href="{% resource 'logo16.png' %}" />
    <link rel="icon" type="image/png" sizes="32x32" href="{% resource 'logo32.png' %}" />
    <link rel="icon" type="image/png" sizes="96x96" href="{% resource 'logo96.png' %}" />
    <link rel="icon" type="image/png" sizes="192x192" href="{% resource 'logo192.png' %}" />
    <link rel="icon" type="image/png" sizes="512x512" href="{% resource 'logo512.png' %}" />
    <meta name="theme-color" content="#000" />
    <meta name="application-name" content="BLEX" />
    <meta name="msapplication-TileImage" content="{% resource 'logo144.png' %}" />
    <meta name="msapplication-TileColor" content="#000" />
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    {% block extra_styles %}{% endblock %}
</head>

<body class="bg-gray-50">
    {% include 'components/header.html' %}

    <main class="min-h-[calc(100vh-10.5rem)] flex flex-col px-4 py-8">
        {% block content %}{% endblock %}
    </main>

    {% include 'components/footer.html' %}

    <script>
        window.configuration = {
            host: "{{ request}}",
            static: "{% resource '' %}",
            {% if user.is_authenticated %}
            user: {
                isAuthenticated: "{{ user.is_authenticated }}",
                username: "{{ user.username }}",
            },
            {% endif %}
            googleClientId: "{{ GOOGLE_OAUTH_CLIENT_ID|default:'' }}",
            githubClientId: "{{ GITHUB_OAUTH_CLIENT_ID|default:'' }}"
        };
    </script>

    <script>
        const lazyImages = Array.from(document.querySelectorAll('img.lazy'));
        const lazyVideos = Array.from(document.querySelectorAll('video.lazy'));

        if ('IntersectionObserver' in window) {
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const image = entry.target;
                        image.src = image.dataset.src;
                        image.classList.remove('lazy');
                        imageObserver.unobserve(image);
                    }
                });
            });

            lazyImages.forEach(image => {
                imageObserver.observe(image);
            });

            const videoObserver = new IntersectionObserver((entries, observer) => {
                // source의 data-src를 src로 변경
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const video = entry.target;
                        const source = video.querySelector('source');
                        source.src = source.dataset.src;
                        video.load();
                        video.classList.remove('lazy');
                        videoObserver.unobserve(video);
                    }
                });
            });

            lazyVideos.forEach(video => {
                videoObserver.observe(video);
            });
        } else {
            lazyImages.forEach(image => {
                image.src = image.dataset.src;
                image.classList.remove('lazy');
            });
            lazyVideos.forEach(video => {
                const source = video.querySelector('source');
                source.src = source.dataset.src;
                video.load();
                video.classList.remove('lazy');
            });
        }
    </script>

    {% block extra_scripts %}{% endblock %}

    {% vite_hmr_client %}
    <script type="module" src="{% island_entry 'src/island.tsx' %}"></script>
</body>

</html>
