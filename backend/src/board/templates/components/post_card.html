{% comment %}
Post card component
Parameters:
- post: Post object with details (required)
- show_author: Boolean to show/hide author section (default: true)
- author_username: Author username (optional, will use post.author_username if not provided)
{% endcomment %}

{% load static %}
{% load island %}
{% load resource %}

<article class="group bg-surface rounded-2xl flex flex-col overflow-hidden ring-1 ring-line/60 hover:ring-line-strong/70 active:scale-[0.98] transition-all duration-150">
    {% if post.image %}
        <div class="aspect-[16/9] overflow-hidden">
            <a href="/@{{ post.author }}/{{ post.url }}" class="block h-full">
                <img
                    class="w-full h-full object-cover motion-safe:group-hover:scale-105 motion-safe:transition-transform motion-safe:duration-500"
                    src="{{ post.get_minify_image }}"
                    srcset="{{ post.get_minify_image }} 400w, {{ post.image.url }} 800w"
                    sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 25vw"
                    alt="{{ post.title }}"
                    loading="{% if priority %}eager{% else %}lazy{% endif %}"
                >
            </a>
        </div>
    {% endif %}
    <div class="p-5 flex flex-col flex-grow">
        <h3 class="text-md font-bold text-content leading-snug mb-3 line-clamp-2">
            <a href="/@{{ post.author }}/{{ post.url }}" class="hover:text-content-secondary transition-colors duration-150">{{ post.title }}</a>
        </h3>

        <div class="text-xs text-content-secondary mb-3 flex items-center gap-3">
            <div class="flex items-center gap-1.5">
                <i class="far fa-calendar-alt text-content-hint"></i>
                <time datetime="{{ post.published_date|date:'c' }}">{% if post.time_display %}{{ post.time_display }}{% else %}{{ post.published_date|date:"Y년 n월 j일" }}{% endif %}</time>
            </div>
            <div class="flex items-center gap-1.5">
                <i class="far fa-clock text-content-hint"></i>
                <span>{{ post.read_time }}분</span>
            </div>
        </div>

        <p class="text-sm text-content-secondary leading-relaxed mb-4 {% if post.image %}line-clamp-3{% else %}flex-grow{% endif %}">
            <a href="/@{{ post.author }}/{{ post.url }}">{{ post.meta_description }}</a>
        </p>

        <footer class="flex justify-between items-center mt-auto pt-4 border-t border-line-light">
            {% if show_author != 'false' and show_author != False %}
            <div class="flex items-center gap-2">
                <a href="/@{{ post.author }}" class="flex-shrink-0">
                    <img
                        class="w-6 h-6 rounded-full ring-2 ring-line-light object-cover"
                        src="{% if post.author_image %}{% media post.author_image %}{% else %}{% resource 'assets/images/default-avatar.jpg' %}{% endif %}"
                        alt="{{ post.author }}"
                        loading="lazy"
                    >
                </a>
                <div class="flex flex-col min-w-0">
                    <a href="/@{{ post.author }}" class="font-semibold text-content hover:text-content-secondary transition-colors text-xs truncate">{{ post.author }}</a>
                </div>
            </div>
            {% else %}
                {% if post.series %}
                <a href="/@{{ post.author }}/series/{{ post.series.url }}" class="inline-flex items-center px-3 py-1.5 max-w-32 bg-surface-subtle text-content rounded-full text-xs font-semibold hover:bg-line-light transition-all duration-150 truncate">
                    <i class="fas fa-layer-group mr-1.5"></i>
                    <span class="truncate">{{ post.series.name }}</span>
                </a>
                {% else %}
                <div></div>
                {% endif %}
            {% endif %}

            <div class="flex items-center gap-4 text-content-secondary">
                <div class="flex items-center gap-1.5 text-xs hover:text-content transition-colors duration-150">
                    <i class="far fa-comment"></i>
                    <span>{{ post.count_comments }}</span>
                </div>
                {% include 'components/like_button.html' with post_url=post.url likes_count=post.count_likes has_liked=post.has_liked size='small' %}
            </div>
        </footer>
    </div>
</article>
