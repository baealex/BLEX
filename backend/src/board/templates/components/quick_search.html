<div
    class="relative {{ quick_search_width|default:'w-64 lg:w-72' }}"
    @click.away="closeQuickSearchDropdown()"
    @keydown.escape="closeQuickSearchDropdown()"
>
    <form
        @submit.prevent="submitQuickSearch()"
        class="h-11 px-3 rounded-full border border-line bg-surface-elevated flex items-center gap-2 transition-all focus-within:ring-2 focus-within:ring-line-strong"
    >
        <i class="fas fa-search text-sm text-content-hint"></i>
        <input
            x-ref="quickSearchInput"
            x-model="quickSearchQuery"
            @focus="openQuickSearchDropdown()"
            @input="onQuickSearchInput()"
            type="text"
            placeholder="검색"
            class="flex-1 min-w-0 bg-transparent text-sm text-content placeholder:text-content-hint focus:outline-none"
            autocomplete="off"
        >
        <kbd class="hidden lg:inline-flex h-6 items-center gap-1 px-2 bg-surface-subtle text-content-secondary text-[10px] font-mono rounded-md border border-line">
            <span class="text-[8px]">⌘</span>K
        </kbd>
    </form>

    <div
        x-show="quickSearchDropdownOpen"
        x-cloak
        x-transition:enter="transition ease-out duration-150"
        x-transition:enter-start="opacity-0 -translate-y-1"
        x-transition:enter-end="opacity-100 translate-y-0"
        x-transition:leave="transition ease-in duration-100"
        x-transition:leave-start="opacity-100 translate-y-0"
        x-transition:leave-end="opacity-0 -translate-y-1"
        class="absolute left-0 right-0 mt-2 bg-surface-elevated rounded-2xl ring-1 ring-line-strong/60 shadow-xl overflow-hidden z-50"
    >
        <div class="px-3 py-2 border-b border-line-light">
            <p
                class="text-[11px] font-semibold text-content-secondary uppercase tracking-wider"
                x-text="quickSearchQuery.trim() ? '빠른 결과' : '최근 검색어'"
            ></p>
        </div>

        <div class="max-h-80 overflow-y-auto">
            <template x-if="!quickSearchQuery.trim()">
                <div class="p-2">
                    <template x-if="recentSearches.length === 0">
                        <p class="px-3 py-8 text-center text-sm text-content-secondary">최근 검색어가 없습니다.</p>
                    </template>

                    <template x-if="recentSearches.length > 0">
                        <ul class="space-y-1">
                            <template x-for="search in recentSearches" :key="search">
                                <li class="flex items-center gap-1">
                                    <button
                                        type="button"
                                        @click="applyRecentSearch(search)"
                                        class="flex-1 h-10 px-3 rounded-lg text-left text-sm text-content-secondary hover:text-content hover:bg-surface-subtle transition-colors"
                                        x-text="search"
                                    ></button>
                                    <button
                                        type="button"
                                        @click="removeRecentSearch(search, $event)"
                                        class="w-10 h-10 rounded-lg text-content-hint hover:text-content-secondary hover:bg-surface-subtle transition-colors"
                                        aria-label="최근 검색어 삭제"
                                    >
                                        <i class="fas fa-times text-xs"></i>
                                    </button>
                                </li>
                            </template>
                        </ul>
                    </template>
                </div>
            </template>

            <template x-if="quickSearchQuery.trim()">
                <div>
                    <template x-if="quickSearchLoading">
                        <p class="px-3 py-8 text-center text-sm text-content-secondary">빠르게 찾는 중...</p>
                    </template>

                    <template x-if="!quickSearchLoading && quickSearchResults.length === 0">
                        <p class="px-3 py-8 text-center text-sm text-content-secondary">빠른 결과가 없습니다.</p>
                    </template>

                    <template x-if="!quickSearchLoading && quickSearchResults.length > 0">
                        <ul class="p-2 space-y-1">
                            <template x-for="result in quickSearchResults" :key="result.author + '-' + result.url">
                                <li>
                                    <a
                                        :href="'/@' + result.author + '/' + result.url"
                                        @click="closeQuickSearchDropdown()"
                                        class="block px-3 py-3 rounded-xl hover:bg-surface-subtle transition-colors"
                                    >
                                        <p class="text-sm font-semibold text-content line-clamp-1" x-text="result.title"></p>
                                        <p class="text-xs text-content-secondary line-clamp-1">
                                            <span x-text="'@' + result.author"></span>
                                            <template x-if="result.description">
                                                <span x-text="' · ' + result.description"></span>
                                            </template>
                                        </p>
                                    </a>
                                </li>
                            </template>
                        </ul>
                    </template>
                </div>
            </template>
        </div>

        <div class="px-3 py-2 border-t border-line-light bg-surface-subtle/70">
            <button
                type="button"
                @click="submitQuickSearch()"
                class="w-full h-10 rounded-lg bg-action text-content-inverted text-sm font-semibold hover:bg-action-hover transition-all active:scale-95"
            >
                전체 검색 결과 보기
            </button>
        </div>
    </div>
</div>
