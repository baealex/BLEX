{% comment %}
Alpine.js 기반 도움됐어요/안됐어요 버튼 컴포넌트
사용법: {% include 'components/thanks_buttons.html' with post_url=post.url %}

매개변수:
- post_url: 포스트 URL (필수)
{% endcomment %}

<div 
    x-data="{ 
        loading: false,
        selectedType: null,
        async handleThanks(type) {
            if (this.loading) return;
            this.loading = true;
            try {
                const endpoint = type === 'thanks' ? '/thanks/{{ post_url }}' : '/nothanks/{{ post_url }}';
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || '',
                        'Content-Type': 'application/json'
                    }
                });
                if (response.ok) {
                    // 선택 상태 업데이트 (토글 방식)
                    if (this.selectedType === type) {
                        this.selectedType = null; // 같은 버튼 클릭시 취소
                    } else {
                        this.selectedType = type; // 다른 버튼이나 처음 클릭시 선택
                    }
                }
            } catch (error) {
                console.error('Thanks action failed:', error);
            } finally {
                this.loading = false;
            }
        }
    }"
    class="flex gap-2 mt-4">
    
    <button 
        @click="handleThanks('thanks')"
        :disabled="loading"
        :class="{
            'opacity-70 cursor-not-allowed': loading,
            'active:scale-95': !loading,
            'bg-green-500 text-white border-green-500 shadow-lg': selectedType === 'thanks',
            'bg-green-50 text-green-700 border-green-200 hover:bg-green-100': selectedType !== 'thanks'
        }"
        class="inline-flex items-center justify-center gap-2 px-4 py-2 border rounded-lg text-sm font-medium transition-all duration-200 outline-none cursor-pointer">
        <i class="fas fa-thumbs-up"></i>
        <span>도움됐어요</span>
    </button>
    
    <button 
        @click="handleThanks('nothanks')"
        :disabled="loading"
        :class="{
            'opacity-70 cursor-not-allowed': loading,
            'active:scale-95': !loading,
            'bg-red-500 text-white border-red-500 shadow-lg': selectedType === 'nothanks',
            'bg-red-50 text-red-700 border-red-200 hover:bg-red-100': selectedType !== 'nothanks'
        }"
        class="inline-flex items-center justify-center gap-2 px-4 py-2 border rounded-lg text-sm font-medium transition-all duration-200 outline-none cursor-pointer">
        <i class="fas fa-thumbs-down"></i>
        <span>안됐어요</span>
    </button>
</div>
