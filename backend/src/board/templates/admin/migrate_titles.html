{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<div id="content-main">
    <div class="breadcrumbs">
        <a href="{% url 'admin:utility_dashboard' %}">ìœ í‹¸ë¦¬í‹° ê´€ë¦¬</a> &rsaquo; íƒ€ì´í‹€ ì´ë¯¸ì§€ ë§ˆì´ê·¸ë ˆì´ì…˜
    </div>
    
    <h1>ğŸ¨ íƒ€ì´í‹€ ì´ë¯¸ì§€ ë§ˆì´ê·¸ë ˆì´ì…˜</h1>
    
    {% if not result %}
    <form method="post" class="module aligned">
        {% csrf_token %}
        
        <div class="help">
            <h3>â„¹ï¸ ë§ˆì´ê·¸ë ˆì´ì…˜ ì•ˆë‚´</h3>
            <p>íƒ€ì´í‹€ ì´ë¯¸ì§€ë¥¼ ë‚ ì§œ ê¸°ë°˜ êµ¬ì¡°ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•©ë‹ˆë‹¤.</p>
            <ul>
                <li>ê¸°ì¡´: <code>images/title/{username}/...</code></li>
                <li>ë³€ê²½: <code>images/title/{YYYY}/{M}/{D}/{username}/...</code></li>
                <li>ì‘ì„±ì¼(created_date) ê¸°ì¤€ìœ¼ë¡œ ë””ë ‰í† ë¦¬ ìƒì„±</li>
                <li>ê´€ë ¨ íŒŒì¼(.preview, .minify)ë„ í•¨ê»˜ ì´ë™</li>
            </ul>
            <p><strong>âš ï¸ Dry-run ëª¨ë“œ</strong>ë¥¼ ë¨¼ì € ì‹¤í–‰í•˜ì—¬ ë§ˆì´ê·¸ë ˆì´ì…˜ ëŒ€ìƒì„ í™•ì¸í•˜ì„¸ìš”.</p>
        </div>
        
        <div class="submit-row" style="display: flex; gap: 10px;">
            <button type="submit" name="execute" value="false" class="default">Dry-run (ë¯¸ë¦¬ë³´ê¸°)</button>
            <button type="submit" name="execute" value="true" class="button" 
                    onclick="return confirm('ì •ë§ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                ì‹¤í–‰ (ë§ˆì´ê·¸ë ˆì´ì…˜)
            </button>
        </div>
    </form>
    {% else %}
    <div class="module">
        <h2>ì‹¤í–‰ ê²°ê³¼</h2>
        
        {% for msg_type, message in result.messages %}
        <p class="
            {% if msg_type == 'success' %}success
            {% elif msg_type == 'error' %}errornote
            {% elif msg_type == 'warning' %}warning
            {% else %}help{% endif %}">
            {{ message }}
        </p>
        {% endfor %}
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
            <div style="text-align: center; padding: 20px; background: var(--body-bg); border: 1px solid var(--hairline-color); border-radius: 4px;">
                <div style="font-size: 36px; font-weight: 600;">{{ result.statistics.total_posts }}</div>
                <div style="font-size: 14px; opacity: 0.7; margin-top: 5px;">ì „ì²´ í¬ìŠ¤íŠ¸ ìˆ˜</div>
            </div>
            
            <div style="text-align: center; padding: 20px; background: var(--body-bg); border: 1px solid var(--hairline-color); border-radius: 4px;">
                <div style="font-size: 36px; font-weight: 600; color: var(--button-bg);">{{ result.statistics.migrated_count }}</div>
                <div style="font-size: 14px; opacity: 0.7; margin-top: 5px;">
                    {% if request.POST.execute == 'true' %}ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ{% else %}ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ˆì •{% endif %}
                </div>
            </div>
        </div>
        
        {% if result.statistics.errors %}
        <h3>ì˜¤ë¥˜ ë°œìƒ</h3>
        <div style="max-height: 300px; overflow-y: auto; border: 1px solid var(--hairline-color); border-radius: 4px; padding: 10px;">
            {% for error in result.statistics.errors %}
            <p class="errornote" style="font-family: monospace; font-size: 12px;">{{ error }}</p>
            {% endfor %}
        </div>
        {% endif %}
        
        <div class="submit-row">
            <a href="{% url 'admin:migrate_titles' %}" class="button">ë‹¤ì‹œ ì‹¤í–‰</a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
