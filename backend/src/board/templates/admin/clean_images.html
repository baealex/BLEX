{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<div id="content-main">
    <div class="breadcrumbs">
        <a href="{% url 'admin:utility_dashboard' %}">ìœ í‹¸ë¦¬í‹° ê´€ë¦¬</a> &rsaquo; ì´ë¯¸ì§€ ì •ë¦¬
    </div>
    
    <h1>ğŸ–¼ï¸ ì´ë¯¸ì§€ ì •ë¦¬</h1>
    
    {% if not result %}
    <form method="post" class="module aligned">
        {% csrf_token %}
        
        <div class="form-row">
            <div>
                <label for="id_target">ì •ë¦¬ ëŒ€ìƒ:</label>
                <select name="target" id="id_target" class="vTextField">
                    <option value="all">ì „ì²´ (ì»¨í…ì¸  + íƒ€ì´í‹€ + ì•„ë°”íƒ€)</option>
                    <option value="content">ì»¨í…ì¸  ì´ë¯¸ì§€ë§Œ</option>
                    <option value="title">íƒ€ì´í‹€ ì´ë¯¸ì§€ë§Œ</option>
                    <option value="avatar">ì•„ë°”íƒ€ ì´ë¯¸ì§€ë§Œ</option>
                </select>
            </div>
        </div>
        
        <div class="help">
            <strong>âš ï¸ Dry-run ëª¨ë“œ</strong>ë¥¼ ë¨¼ì € ì‹¤í–‰í•˜ì—¬ ì‚­ì œë  íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”.
        </div>
        
        <div class="submit-row" style="display: flex; gap: 10px;">
            <button type="submit" name="execute" value="false" class="default">Dry-run (ë¯¸ë¦¬ë³´ê¸°)</button>
            <button type="submit" name="execute" value="true" class="deletelink" 
                    onclick="return confirm('ì •ë§ë¡œ íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');">
                ì‹¤í–‰ (íŒŒì¼ ì‚­ì œ)
            </button>
        </div>
    </form>
    {% else %}
    <div class="module">
        <h2>ì‹¤í–‰ ê²°ê³¼</h2>
        
        {% for msg_type, message in result.messages %}
        <p class="
            {% if msg_type == 'success' %}success
            {% elif msg_type == 'error' %}errornote
            {% elif msg_type == 'warning' %}warning
            {% else %}help{% endif %}">
            {{ message }}
        </p>
        {% endfor %}
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0;">
            {% if result.statistics.used_content_count is not None %}
            <div style="text-align: center; padding: 15px; background: var(--body-bg); border: 1px solid var(--hairline-color); border-radius: 4px;">
                <div style="font-size: 28px; font-weight: 600;">{{ result.statistics.used_content_count }}</div>
                <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">ì‚¬ìš© ì¤‘ ì»¨í…ì¸ </div>
            </div>
            {% endif %}
            
            {% if result.statistics.used_title_count is not None %}
            <div style="text-align: center; padding: 15px; background: var(--body-bg); border: 1px solid var(--hairline-color); border-radius: 4px;">
                <div style="font-size: 28px; font-weight: 600;">{{ result.statistics.used_title_count }}</div>
                <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">ì‚¬ìš© ì¤‘ íƒ€ì´í‹€</div>
            </div>
            {% endif %}
            
            {% if result.statistics.used_avatar_count is not None %}
            <div style="text-align: center; padding: 15px; background: var(--body-bg); border: 1px solid var(--hairline-color); border-radius: 4px;">
                <div style="font-size: 28px; font-weight: 600;">{{ result.statistics.used_avatar_count }}</div>
                <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">ì‚¬ìš© ì¤‘ ì•„ë°”íƒ€</div>
            </div>
            {% endif %}
            
            {% if result.statistics.total_unused is not None %}
            <div style="text-align: center; padding: 15px; background: var(--body-bg); border: 1px solid var(--hairline-color); border-radius: 4px;">
                <div style="font-size: 28px; font-weight: 600; color: var(--error-fg);">{{ result.statistics.total_unused }}</div>
                <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">ë¯¸ì‚¬ìš© íŒŒì¼</div>
            </div>
            {% endif %}
            
            {% if result.statistics.total_size_mb is not None %}
            <div style="text-align: center; padding: 15px; background: var(--body-bg); border: 1px solid var(--hairline-color); border-radius: 4px;">
                <div style="font-size: 28px; font-weight: 600; color: var(--error-fg);">{{ result.statistics.total_size_mb }} MB</div>
                <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">ì ˆì•½ ê°€ëŠ¥</div>
            </div>
            {% endif %}
        </div>
        
        {% if result.files %}
        <h3>ë¯¸ì‚¬ìš© íŒŒì¼ ëª©ë¡ (ìµœëŒ€ 100ê°œ)</h3>
        <div style="max-height: 400px; overflow-y: auto; border: 1px solid var(--hairline-color); border-radius: 4px;">
            <table>
                <thead>
                    <tr>
                        <th>íŒŒì¼ëª…</th>
                        <th style="text-align: right;">í¬ê¸° (KB)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for file in result.files|slice:":100" %}
                    <tr class="{% cycle 'row1' 'row2' %}">
                        <td style="font-family: monospace; font-size: 12px;">{{ file.relative_path }}</td>
                        <td style="text-align: right;">{{ file.size_kb }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if result.files|length > 100 %}
        <p class="help">... ì™¸ {{ result.files|length|add:"-100" }}ê°œ íŒŒì¼</p>
        {% endif %}
        {% endif %}
        
        <div class="submit-row">
            <a href="{% url 'admin:clean_images' %}" class="button">ë‹¤ì‹œ ì‹¤í–‰</a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
